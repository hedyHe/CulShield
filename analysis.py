#coding=utf-8
# Draw various statistical graphs, inlcuding pearsons, geo4jsr

import os, random
import json, traceback
from tqdm import tqdm
import numpy as np 
from collections import defaultdict 
from scipy.stats import pearsonr, spearmanr
import matplotlib.pyplot as plt
from statistic import statistic4implicit
import matplotlib.lines as mlines
import pandas as pd
import geopandas as gpd
import matplotlib.patches as mpatches
import matplotlib as mpl


class Draw:
    def __init__(self):
        self.mappings = {"Afghan": None, "American": "United States", "Argentine": "Argentina ", "Australian": "Australia", "Austrian": "Austria", "Bangladeshi": "Bangladesh", 
                "Bosnian": "Bosnia and Herzegovina", "Brazilian": "Brazil", "British": "Great Britain", "Cambodian": None, "Canadian": "Canada", "Chilean": "Chile", 
                "Chinese": "China", "Colombian": "Colombia", "Croatian": "Croatia", "Cypriot": "Cyprus", "Dutch": None, "Egyptian": "Egypt", 
                "Ethiopian": "Ethiopia", "Fijian": None, "Filipino": None, "French": "France", "German": "Germany", "Greek": None, "Hungarian": "Hungary", 
                "Indian": "India", "Indonesian": "Indonesia", "Iranian": "Iran", "Iraqi": "Iraq", "Israeli": "Israel", "Italian": "Italy", 
                "Japanese": "Japan", "Kenyan": "Kenya", "Lao": None, "Lebanese": "Lebanon", "Macedonian": "North Macedonia", "Malaysian": "Malaysia", 
                "Maltese": "Malta", "Mauritian": "Mauritius", "Mexican": "Mexico", "Nepalese": None, "New Zealand": "New Zealand", "North Sudanese": None, "Pakistani": "Pakistan", 
                "Palestinian": "Palestine", "Papua New Guinean": None, "Peruvian": None, "Polish": "Poland", "Portuguese": "Portugal", "Romanian": "Romania", "Russian": "Russia", 
                "Samoan": None, "Saudi Arabian": "Saudi Arabia", "Serbian": "Serbia", "Singaporean": "Singapore", "Somali": None, "South African": "South Africa", "South Korean": "South Korea", 
                "South Sudanese": None, "Spanish": "Spain", "Sri Lankan": None, "Swedish": "Sweden", "Syrian": None, "Taiwanese": None, "Thai": "Thailand", "Tongan": None, 
                "Turkish": "Turkey", "Ukrainian": "Ukraine", "Vietnamese": "Vietnam", "Zimbabwean": "Zimbabwe"}
    
        self.country_ab = {"American": "USA", 
            "Australian": "AUS", 
            "Austrian": "AUT", 
            "Bangladeshi": "BGD", 
            "Bosnian": "BIH", 
            "Brazilian": "BRA", 
            "British": "GBR", 
            "Canadian": "CAN", 
            "Chilean": "CHI", 
            "Chinese": "CHN", 
            "Colombian": "COL", 
            "Croatian": "CRO", 
            "Cypriot": "CYP", 
            "Egyptian": "EGY", 
            "Ethiopian": "ETH", 
            "French": "FRA", 
            "German": "GER", 
            "Hungarian": "HUN", 
            "Indian": "IND", 
            "Indonesian": "INA", 
            "Iranian": "IRI", 
            "Iraqi": "IRQ", 
            "Israeli": "ISR", 
            "Italian": "ITA", 
            "Japanese": "JPN", 
            "Kenyan": "KEN", 
            "Lebanese": "LIB", 
            "Macedonian": "MKD", 
            "Malaysian": "MAS", 
            "Maltese": "MLT", 
            "Mexican": "MEX", 
            "New Zealand": "NZL", 
            "Pakistani": "PAK", 
            "Palestinian": "PLE", 
            "Polish": "POL", 
            "Portuguese": "POR", 
            "Romanian": "ROM", 
            "Russian": "RUS", 
            "Saudi Arabian": "KSA", 
            "Serbian": "SCG", 
            "Singaporean": "SIN", 
            "South African": "RSA", 
            "South Korean": "KOR", 
            "Spanish": "ESP", 
            "Swedish": "SWE", 
            "Thai": "THA", 
            "Turkish": "TUR", 
            "Ukrainian": "UKR", 
            "Vietnamese": "VIE", 
            "Zimbabwean": "ZIM"
            }

        self.cul_maps = {
            "1998": {
                "Albania": [
                    0.5704982027463682,
                    -1.0103227213061319
                ],
                "Bosnia and Herzegovina": [
                    0.09102811875445829,
                    -0.42611640626108777
                ],
                "Taiwan ROC": [
                    0.6459479299419087,
                    -0.6573412694028581
                ],
                "Czechia": [
                    1.142001461582252,
                    0.849465547559113
                ],
                "Hungary": [
                    0.7913895394757774,
                    -0.079467925471398
                ],
                "New Zealand": [
                    -0.03755888468911338,
                    2.062837959890985
                ],
                "Romania": [
                    0.4938797181869398,
                    -0.9457911486711963
                ],
                "Slovakia": [
                    0.48630341911399033,
                    0.1532918732469939
                ],
                "North Macedonia": [
                    0.6457185204132903,
                    -0.7088548734772243
                ]
            },
            "2002": {
                "Albania": [
                    0.13340525824230245,
                    -0.7854383781689434
                ],
                "Algeria": [
                    -1.26966166264354,
                    -1.197026385364911
                ],
                "Bangladesh": [
                    -1.100096184910719,
                    -1.0373914447814825
                ],
                "Moldova": [
                    1.0266977005554352,
                    -1.569242388274409
                ],
                "Singapore": [
                    -0.2127491448570421,
                    -0.4229790020027021
                ]
            },
            "2008": {
                "Albania": [
                    0.28933445248095785,
                    -0.9417261611620326
                ],
                "Azerbaijan": [
                    0.21753069407096626,
                    -0.7063304021711183
                ],
                "Austria": [
                    0.3808339298707409,
                    0.9845080927342528
                ],
                "Armenia": [
                    -0.41987207859077824,
                    -0.9410048494822875
                ],
                "Bosnia and Herzegovina": [
                    0.08407793199637688,
                    -0.8171528154985759
                ],
                "Bulgaria": [
                    0.8819393758506977,
                    -0.9071170992170177
                ],
                "Belarus": [
                    0.21253565208492234,
                    -0.7005761263134836
                ],
                "Croatia": [
                    -0.08507993538087841,
                    -0.11607671944502816
                ],
                "Cyprus": [
                    -0.565559201910577,
                    -0.6163744830392632
                ],
                "Czechia": [
                    1.0251770432855396,
                    0.5390415914183434
                ],
                "Denmark": [
                    0.552116514976396,
                    2.834535379105454
                ],
                "Estonia": [
                    0.9329118429111637,
                    -0.2816143960203087
                ],
                "France": [
                    0.47395954021322617,
                    1.4086148478221086
                ],
                "Georgia": [
                    -0.5989060050657159,
                    -1.1430624909135274
                ],
                "Germany": [
                    1.1875301950824824,
                    0.9890400184050169
                ],
                "Greece": [
                    0.03484600228029018,
                    0.026573870975531058
                ],
                "Hungary": [
                    0.6302299600989637,
                    -0.3961915907885423
                ],
                "Ireland": [
                    -0.848228624296211,
                    1.1297447863146932
                ],
                "Latvia": [
                    0.8943762155289918,
                    -0.46902531655561575
                ],
                "Lithuania": [
                    0.993682582143903,
                    -0.7096963755034776
                ],
                "Luxembourg": [
                    0.32735914523421084,
                    1.3817334341568823
                ],
                "Malta": [
                    -1.2712790629938189,
                    0.1761273702048649
                ],
                "Moldova": [
                    0.18176557311942662,
                    -1.5501721720159745
                ],
                "Montenegro": [
                    0.1857228265732045,
                    -0.6551930280888684
                ],
                "Netherlands": [
                    0.11649998781176778,
                    2.322760355778516
                ],
                "Norway": [
                    0.6448894690632839,
                    2.612959598612193
                ],
                "Poland": [
                    -0.2383510145833561,
                    -0.20211872967841543
                ],
                "Portugal": [
                    -0.15694287698352163,
                    0.21790727437865168
                ],
                "Romania": [
                    -0.09899929821781529,
                    -1.143754270668089
                ],
                "Russia": [
                    0.40818583544756193,
                    -0.9314180517385211
                ],
                "Serbia": [
                    0.2152737745037916,
                    -0.789538242859999
                ],
                "Slovakia": [
                    0.2201698925999337,
                    0.24712440931933902
                ],
                "Slovenia": [
                    0.6360229405366973,
                    0.7926196480213845
                ],
                "Spain": [
                    0.11063994206554773,
                    1.194697303323275
                ],
                "Switzerland": [
                    0.28518954392554213,
                    1.940238673230507
                ],
                "Ukraine": [
                    0.29138959255142594,
                    -1.265754695042338
                ],
                "North Macedonia": [
                    0.12470898854512596,
                    -0.11677791939033529
                ],
                "Northern Ireland": [
                    -0.5301482648299514,
                    0.5452462772239876
                ],
                "Kosovo": [
                    -1.1318212912773287,
                    -0.4242892010153747
                ]
            },
            "2018": {
                "Albania": [
                    -0.7450601184125186,
                    -0.8307157222402705
                ],
                "Andorra": [
                    0.5486002541894003,
                    2.1822863571289495
                ],
                "Azerbaijan": [
                    -0.4054529793747549,
                    -0.8403417111700384
                ],
                "Australia": [
                    0.5492768964408262,
                    2.262706343958568
                ],
                "Austria": [
                    0.6196183563642192,
                    1.9400005916490128
                ],
                "Bangladesh": [
                    -1.5034430231341471,
                    -0.6874789306760578
                ],
                "Armenia": [
                    -0.2727343944343033,
                    -0.9002567929257942
                ],
                "Brazil": [
                    -0.30784002094104207,
                    -0.09730070787435803
                ],
                "Belarus": [
                    0.2919760944916926,
                    -0.3205069707699776
                ],
                "Chile": [
                    0.21327090156727982,
                    -0.10891501474929909
                ],
                "China": [
                    0.5754614230578385,
                    -0.10705898216209847
                ],
                "Colombia": [
                    -1.5680918496880982,
                    0.2641582083764575
                ],
                "Ecuador": [
                    -1.7247662884867112,
                    0.01824090383322755
                ],
                "Estonia": [
                    0.8958433735314537,
                    0.7034629778200895
                ],
                "France": [
                    0.464430927425972,
                    1.9023815878631491
                ],
                "Georgia": [
                    -1.01787727959337,
                    -0.8170594419278617
                ],
                "Germany": [
                    0.8909287933023875,
                    2.1561276772892057
                ],
                "Hong Kong SAR": [
                    1.458907829118193,
                    -0.058246061823268684
                ],
                "Hungary": [
                    0.593182807259423,
                    0.023539908256361437
                ],
                "Indonesia": [
                    -1.2194222353749737,
                    -0.8402769999960561
                ],
                "Iraq": [
                    -0.8453,
                    -1.3175
                ],
                "Italy": [
                    0.346994868017184,
                    0.8010532976127079
                ],
                "Kazakhstan": [
                    -0.12884861927834357,
                    -0.6824478191772065
                ],
                "Jordan": [
                    -1.5785210071635836,
                    -1.2089820681136112
                ],
                "South Korea": [
                    1.4535702482927149,
                    -0.4708349068303583
                ],
                "Lebanon": [
                    -0.5351886968493137,
                    -1.0751042204972237
                ],
                "Lithuania": [
                    0.8618517208799167,
                    -0.18407205079556538
                ],
                "Malaysia": [
                    0.05458750409618937,
                    -0.3823453328537913
                ],
                "Mexico": [
                    -1.060339019973165,
                    0.22602041304907608
                ],
                "Nigeria": [
                    -1.373645719723923,
                    -1.10277608289003
                ],
                "Norway": [
                    0.9264695491307943,
                    3.0306983482306706
                ],
                "Pakistan": [
                    -1.3833162631138043,
                    -0.6329570426058552
                ],
                "Peru": [
                    -1.0557212108940088,
                    -0.5628571862684199
                ],
                "Puerto Rico": [
                    -1.5550555025528636,
                    0.6596927614576703
                ],
                "Romania": [
                    -0.3876113280512605,
                    -0.8016724902481395
                ],
                "Serbia": [
                    0.310579367756744,
                    -0.5770154341377506
                ],
                "Thailand": [
                    0.2545070669272828,
                    0.06584884041841116
                ],
                "Turkey": [
                    -0.45628842179104184,
                    -0.7040694925194755
                ],
                "Egypt": [
                    -0.854366567779921,
                    -2.23184719071852
                ],
                "Great Britain": [
                    0.39976743211289323,
                    2.333186256749181
                ]
            },
            "2014": {
                "Algeria": [
                    -0.7797849161398054,
                    -0.9247121734157151
                ],
                "Brazil": [
                    -0.7749486945140546,
                    -0.04758572629874166
                ],
                "Georgia": [
                    -0.7419078457697261,
                    -1.4388648387037197
                ],
                "Hong Kong SAR": [
                    0.907313240393732,
                    0.34178585300646114
                ],
                "Jordan": [
                    -1.3855581569001703,
                    -1.5157171975127333
                ],
                "Libya": [
                    -1.5802708879292593,
                    -1.0002938446632874
                ],
                "Yemen": [
                    -1.3640890684611982,
                    -1.2543215098013838
                ]
            },
            "2005": {
                "Andorra": [
                    0.747073157391682,
                    1.8003086454119077
                ],
                "Australia": [
                    -0.14133638776286675,
                    1.982481451949708
                ],
                "Colombia": [
                    -1.803832110017283,
                    0.1706977573166501
                ],
                "Finland": [
                    0.42910944005823654,
                    1.5985982162366699
                ],
                "Italy": [
                    -0.15184740224218735,
                    0.44993271387104883
                ],
                "Japan": [
                    1.8573388657598526,
                    0.7819666827478999
                ],
                "South Korea": [
                    1.0320820047117036,
                    -0.42022690052539824
                ],
                "Mexico": [
                    -1.5155032569413036,
                    0.6342430612287734
                ],
                "Poland": [
                    -0.6809929059047312,
                    -0.2819308859140897
                ],
                "Romania": [
                    -0.08248261229428616,
                    -1.5021846973845727
                ],
                "Slovenia": [
                    0.8733191616150584,
                    0.8235177298990447
                ],
                "Great Britain": [
                    -0.20836276634855433,
                    1.873991808664959
                ]
            },
            "1997": {
                "Azerbaijan": [
                    -0.14706510882462392,
                    -1.1256326442616154
                ],
                "Armenia": [
                    0.6815309179216096,
                    -0.9501650991240042
                ],
                "Brazil": [
                    -1.0628101651044088,
                    -0.40116310864834
                ],
                "Bulgaria": [
                    1.0415482570311867,
                    -0.3682515053814357
                ],
                "Germany": [
                    1.7471285921481545,
                    1.1481546891632903
                ],
                "Lithuania": [
                    1.1119929574335878,
                    -1.070704994494116
                ]
            },
            "2011": {
                "Azerbaijan": [
                    -0.614356113277349,
                    -1.2905852756808502
                ],
                "Armenia": [
                    -0.7331783841921308,
                    -1.194615866778369
                ],
                "Cyprus": [
                    -0.2704822790889929,
                    -0.4057284148809874
                ],
                "Estonia": [
                    1.25306349257291,
                    -0.3336648186915806
                ],
                "Kazakhstan": [
                    -0.27558602484740713,
                    -0.6642970139652453
                ],
                "Kyrgyzstan": [
                    -0.5778117598795444,
                    -0.7411809071949254
                ],
                "Morocco": [
                    -1.0582171174044486,
                    -1.5129519701765193
                ],
                "New Zealand": [
                    0.09841622572208003,
                    2.2988114951342276
                ],
                "Russia": [
                    0.46411163152528584,
                    -0.8636283458343964
                ],
                "Slovenia": [
                    0.9500977904094584,
                    0.8514244224611134
                ],
                "Spain": [
                    0.5042852862105098,
                    0.7605280803255502
                ],
                "Sweden": [
                    1.3212817114438173,
                    2.899177147444494
                ],
                "Turkey": [
                    -1.0215232308656446,
                    -0.7315697820626269
                ],
                "Ukraine": [
                    0.5243352021886243,
                    -1.1968401815997953
                ],
                "United States": [
                    -0.3326711449698155,
                    1.2923880657296636
                ],
                "Uruguay": [
                    -0.18708386562967308,
                    0.7684371469460051
                ],
                "Uzbekistan": [
                    -1.32297260217653,
                    -0.57759273809478
                ]
            },
            "1984": {
                "Argentina": [
                    0.14634805325053699,
                    -0.36626209796309717
                ],
                "Iceland": [
                    -0.33760980726671574,
                    0.8786139239217985
                ]
            },
            "1991": {
                "Argentina": [
                    -0.4097937905501441,
                    -0.19554678761708336
                ],
                "Brazil": [
                    -0.7772817475223718,
                    -0.5852308741270419
                ],
                "Bulgaria": [
                    1.5285095093880283,
                    -0.7079954857760863
                ],
                "Czechia": [
                    1.2179530098143976,
                    0.23789963860930602
                ],
                "Hungary": [
                    0.621818479976959,
                    -0.6398083714951273
                ],
                "Malta": [
                    -1.725944985180262,
                    -0.2663123557538385
                ],
                "Slovakia": [
                    0.9029988324616516,
                    -0.4702037165047388
                ]
            },
            "1995": {
                "Argentina": [
                    -0.4856991624843777,
                    0.3797664140020474
                ],
                "Australia": [
                    -0.4768714477266672,
                    1.9388372255717297
                ],
                "India": [
                    -0.6316341665054044,
                    -0.35788318317254736
                ],
                "Japan": [
                    1.067948463614059,
                    0.7294090070998283
                ],
                "Nigeria": [
                    -1.350837110939771,
                    -1.057271545843598
                ],
                "Puerto Rico": [
                    -1.8786198845499895,
                    0.09248214256030364
                ],
                "Russia": [
                    1.1920983389827677,
                    -1.315533099606309
                ],
                "Slovenia": [
                    0.7681442172476994,
                    0.1883879333937716
                ],
                "Spain": [
                    -0.3066401029248113,
                    0.4929348120686174
                ],
                "United States": [
                    -1.2569954160776742,
                    1.4368439021053303
                ]
            },
            "1999": {
                "Argentina": [
                    -0.8918151388579003,
                    0.12566278780785747
                ],
                "Austria": [
                    0.20926902961022262,
                    1.3774939305364768
                ],
                "Belgium": [
                    0.43170115255090896,
                    1.1216637690791857
                ],
                "Bulgaria": [
                    1.2182263907660331,
                    -0.804662872118807
                ],
                "Czechia": [
                    1.2937707277040849,
                    0.8201314873990313
                ],
                "Denmark": [
                    0.8263076011356058,
                    2.4684835800985248
                ],
                "Estonia": [
                    1.4487825744021137,
                    -0.767223380639908
                ],
                "France": [
                    0.3940530829767957,
                    1.1426974070365201
                ],
                "Germany": [
                    1.312505125618657,
                    0.726735212919372
                ],
                "Greece": [
                    0.4523336451047507,
                    0.6202860369777216
                ],
                "Hungary": [
                    0.5005705327202854,
                    -0.9365732610002093
                ],
                "Iceland": [
                    -0.00682693167782172,
                    1.9855850257137673
                ],
                "Ireland": [
                    -1.0838126666675467,
                    1.052774735855312
                ],
                "Italy": [
                    0.02439319472312264,
                    0.7274526630343154
                ],
                "Latvia": [
                    0.9130867849860882,
                    -0.9729985445269794
                ],
                "Lithuania": [
                    1.046830831171036,
                    -0.752033883911666
                ],
                "Luxembourg": [
                    0.3912308625298868,
                    1.3552231717118468
                ],
                "Malta": [
                    -1.4583450776758564,
                    -0.3478690738964373
                ],
                "Netherlands": [
                    0.5079020907246703,
                    2.1601908475744414
                ],
                "Poland": [
                    -0.5302576034478881,
                    -0.40672691539061706
                ],
                "Portugal": [
                    -0.6591813676683773,
                    -0.21618161258464816
                ],
                "Romania": [
                    0.13542882488646493,
                    -1.4551185946706873
                ],
                "Russia": [
                    1.2729217965070592,
                    -1.2551892767002473
                ],
                "Slovakia": [
                    0.7554796890719848,
                    -0.042648243488426704
                ],
                "Slovenia": [
                    0.8957894012037456,
                    0.7209005806058285
                ],
                "Spain": [
                    0.16621341938268705,
                    0.6107973130103835
                ],
                "Sweden": [
                    0.9751536253978654,
                    2.8080208049955586
                ],
                "Ukraine": [
                    1.1345182836023835,
                    -1.3358311999844936
                ],
                "United States": [
                    -0.9018717913964415,
                    1.6324503016688232
                ],
                "Northern Ireland": [
                    -0.6221296865681692,
                    0.6655495322284745
                ]
            },
            "2006": {
                "Argentina": [
                    -0.8204168665116879,
                    0.44011531166757595
                ],
                "Brazil": [
                    -0.8655120443918665,
                    -0.01509441543927507
                ],
                "Bulgaria": [
                    1.1570492493499733,
                    -0.5455181005290741
                ],
                "Canada": [
                    -0.6644711594407985,
                    1.979928101329504
                ],
                "Chile": [
                    -0.642739865236605,
                    -0.2001030679321339
                ],
                "Taiwan ROC": [
                    1.4260045665483225,
                    -0.9438738200067838
                ],
                "Cyprus": [
                    -0.5435681624257734,
                    -0.05002781145476672
                ],
                "France": [
                    0.5523105065894613,
                    1.5082504917960922
                ],
                "Germany": [
                    1.3378890947641522,
                    1.1499882946376065
                ],
                "India": [
                    -0.4249580336535181,
                    -0.15157342033009316
                ],
                "Indonesia": [
                    -0.43485368819093956,
                    -1.1102256653832399
                ],
                "Malaysia": [
                    -0.6166199105307542,
                    -0.4324872474284303
                ],
                "Moldova": [
                    0.827500309430663,
                    -1.6673352324604545
                ],
                "Netherlands": [
                    0.48281080594701337,
                    1.7627232325940119
                ],
                "Russia": [
                    0.6231719256570977,
                    -1.0200628886193388
                ],
                "Serbia": [
                    0.508961913361795,
                    -0.2369150529582482
                ],
                "Vietnam": [
                    -0.5065489169972381,
                    -0.05874097047679874
                ],
                "Sweden": [
                    1.2741700413131314,
                    3.0117629858889714
                ],
                "Trinidad and Tobago": [
                    -1.7748532750299197,
                    -0.3057622952777172
                ],
                "Ukraine": [
                    0.3552428959949813,
                    -1.0683422512247536
                ],
                "United States": [
                    -0.6254434536079483,
                    1.2738993627871678
                ],
                "Uruguay": [
                    -0.4857012086845521,
                    0.967293969840152
                ]
            },
            "2013": {
                "Argentina": [
                    -0.22813767156258713,
                    0.25236274823500043
                ],
                "China": [
                    0.8366954094200142,
                    -0.41463646289258965
                ],
                "Ecuador": [
                    -1.7367625764098147,
                    -0.225369347193714
                ],
                "Palestine": [
                    -0.91662437859645,
                    -1.3679436230824193
                ],
                "Germany": [
                    0.878445984859466,
                    1.1578428237591438
                ],
                "Iraq": [
                    -0.8316994426484801,
                    -1.3663764265459208
                ],
                "Lebanon": [
                    -0.09460009432219886,
                    -0.8915259766665747
                ],
                "South Africa": [
                    -0.2706028747214673,
                    0.02695046588582274
                ],
                "Thailand": [
                    -0.2299458364304866,
                    -0.1459865615344711
                ],
                "Tunisia": [
                    -0.8195636251706064,
                    -1.7052950361748966
                ]
            },
            "2017": {
                "Argentina": [
                    -0.40094150927422856,
                    0.19130501032474503
                ],
                "Bolivia": [
                    -1.226608424790412,
                    -0.38281354309664417
                ],
                "Bulgaria": [
                    0.6677635133919487,
                    -0.5379608565054707
                ],
                "Croatia": [
                    0.093736725835973,
                    0.08211042633983699
                ],
                "Czechia": [
                    1.1762100207395871,
                    0.9930441181520947
                ],
                "Denmark": [
                    1.018058044512694,
                    2.8932631595832397
                ],
                "Finland": [
                    0.7985040617251449,
                    2.4459536521981207
                ],
                "Germany": [
                    1.0825237379007044,
                    1.9744393330312975
                ],
                "Greece": [
                    0.26863268666960877,
                    -0.28525319998588333
                ],
                "Iceland": [
                    0.5041635342551759,
                    2.9079709557477416
                ],
                "Netherlands": [
                    0.6967975878436202,
                    2.5025300490267335
                ],
                "Poland": [
                    -0.43095948302511644,
                    0.5982128605413148
                ],
                "Russia": [
                    0.3894809799273479,
                    -0.5950410429352009
                ],
                "Serbia": [
                    0.4830575736736253,
                    -0.1386576472296018
                ],
                "Slovakia": [
                    0.5872062935723499,
                    0.558363315559028
                ],
                "Slovenia": [
                    0.7766926615690998,
                    1.231032188645977
                ],
                "Spain": [
                    0.5884059273023041,
                    1.431875179986903
                ],
                "Sweden": [
                    1.1067168288533982,
                    3.113339494654948
                ],
                "Switzerland": [
                    0.6753813196498702,
                    2.351560866566254
                ],
                "United States": [
                    0.1443651554080171,
                    1.4033771221518045
                ]
            },
            "2012": {
                "Australia": [
                    0.2047128062974277,
                    1.9703566153038772
                ],
                "Chile": [
                    -0.28483114159903417,
                    0.15881354047877017
                ],
                "Taiwan ROC": [
                    1.1514296539934843,
                    -0.2330070753697512
                ],
                "Colombia": [
                    -1.7835564805293533,
                    0.10745640108005208
                ],
                "Ghana": [
                    -1.8357794512107684,
                    -1.0443366933718325
                ],
                "India": [
                    -0.7095410646998516,
                    -0.8614942714184771
                ],
                "Malaysia": [
                    -1.0314289377238257,
                    -0.7060888900227704
                ],
                "Mexico": [
                    -1.624684269907971,
                    0.5774784895469334
                ],
                "Netherlands": [
                    0.7245139922652563,
                    2.099169569969736
                ],
                "Nigeria": [
                    -1.2866801600434363,
                    -0.775794492773107
                ],
                "Pakistan": [
                    -1.1523615134455012,
                    -0.6211481823531523
                ],
                "Peru": [
                    -0.9686588537418608,
                    -0.33343134764595256
                ],
                "Philippines": [
                    -1.2616566917695504,
                    -0.0687508644272297
                ],
                "Poland": [
                    -0.5499757562439889,
                    0.06363102586114482
                ],
                "Romania": [
                    -0.20739010513131667,
                    -1.154823187498904
                ],
                "Rwanda": [
                    -1.0995073426724438,
                    -0.7069211954554774
                ],
                "Zimbabwe": [
                    -1.2293139143240404,
                    -0.928207966959933
                ]
            },
            "1990": {
                "Austria": [
                    0.042239933566628474,
                    0.6894755347433974
                ],
                "Belgium": [
                    0.3527439490600812,
                    0.7933275291227854
                ],
                "Belarus": [
                    1.1291163172949583,
                    -0.7168495608769686
                ],
                "Canada": [
                    -0.22045469517409913,
                    1.3635852636543266
                ],
                "Chile": [
                    -0.9104717918649642,
                    -0.6510750914877169
                ],
                "Finland": [
                    0.9304231501477948,
                    1.4171147288069288
                ],
                "France": [
                    0.4850392482226634,
                    0.7001196408003896
                ],
                "Germany": [
                    1.1407950468142267,
                    0.7078149823631431
                ],
                "Iceland": [
                    0.05571161347835737,
                    1.3558232195727775
                ],
                "India": [
                    -0.44490189051780205,
                    -0.4866857306815849
                ],
                "Ireland": [
                    -1.340519532679247,
                    0.7590797917885135
                ],
                "Italy": [
                    0.006162537768594391,
                    0.4008513846915823
                ],
                "Japan": [
                    1.587883247789511,
                    0.22531256877667696
                ],
                "Mexico": [
                    -0.32926823411419803,
                    0.06596643077392951
                ],
                "Netherlands": [
                    0.5836659486562648,
                    1.939944440881968
                ],
                "Nigeria": [
                    -1.2341915706807494,
                    -1.0578401561868933
                ],
                "Norway": [
                    0.7995529763150899,
                    1.2813017749819648
                ],
                "Poland": [
                    -0.6357184460455471,
                    -0.9148460659092971
                ],
                "Portugal": [
                    0.07272248371576377,
                    -0.36808217720531516
                ],
                "Russia": [
                    1.3023323029800415,
                    -0.8137613642712713
                ],
                "South Africa": [
                    -0.8608343367291726,
                    -0.5509671327066761
                ],
                "Spain": [
                    0.0847702533275335,
                    0.2556716022305412
                ],
                "Sweden": [
                    0.8411177947495784,
                    1.767102502656648
                ],
                "Turkey": [
                    -0.7073612173454188,
                    -0.4732495550275252
                ],
                "Great Britain": [
                    -0.1859529469719563,
                    1.258823230467065
                ],
                "United States": [
                    -1.0717440197685002,
                    1.2692357763655344
                ],
                "Northern Ireland": [
                    -1.0334642963403498,
                    0.590384050389133
                ]
            },
            "2021": {
                "Armenia": [
                    -1.310964756017827,
                    -0.7100100454852128
                ],
                "Kenya": [
                    -0.9285455738452243,
                    -0.2731282985646486
                ],
                "Latvia": [
                    0.8397804470682759,
                    -0.048430201829730284
                ],
                "Maldives": [
                    -1.3779685862101403,
                    -0.6482036684050786
                ],
                "Morocco": [
                    -0.3175863475428985,
                    -0.8134872040454398
                ],
                "Venezuela": [
                    -1.0603085945237447,
                    -0.25029057625240075
                ]
            },
            "1981": {
                "Belgium": [
                    0.08707014815253049,
                    0.024892907204954823
                ],
                "Denmark": [
                    0.9694139617284817,
                    1.4263362022319734
                ],
                "France": [
                    0.5146035559839864,
                    0.10901718946785688
                ],
                "Germany West": [
                    0.9123902009670294,
                    0.06141988189223203
                ],
                "Ireland": [
                    -1.3699008496846796,
                    0.1272496791484438
                ],
                "Italy": [
                    0.22989243402292767,
                    -0.49163528604578866
                ],
                "Japan": [
                    1.43876865281075,
                    0.007523862948326692
                ],
                "Mexico": [
                    -0.9728861570974494,
                    -0.7035693124579142
                ],
                "Netherlands": [
                    0.5465560914274663,
                    0.9088870506807657
                ],
                "Spain": [
                    -0.21204547525740275,
                    -0.3926193331481601
                ],
                "Sweden": [
                    0.9959395893949107,
                    1.1942105785283195
                ],
                "Great Britain": [
                    -0.4120738189240878,
                    1.0026187928441013
                ],
                "Northern Ireland": [
                    -0.8358272232423907,
                    -0.11382510678403097
                ]
            },
            "2009": {
                "Belgium": [
                    0.14272052658996523,
                    1.4809837078150168
                ],
                "Finland": [
                    0.8091766641897591,
                    1.8502607764224845
                ],
                "Georgia": [
                    -0.8012972320174423,
                    -1.3163957452120358
                ],
                "Hungary": [
                    0.7013718777256591,
                    -0.30490042693346686
                ],
                "Iceland": [
                    0.14768581248037504,
                    2.426450308366423
                ],
                "Sweden": [
                    1.4743780066172198,
                    2.9684166097803812
                ],
                "Turkey": [
                    -0.8995598581023206,
                    -1.1962215448911018
                ],
                "Great Britain": [
                    -0.04934090425095236,
                    1.7094586669776104
                ]
            },
            "2001": {
                "Bosnia and Herzegovina": [
                    0.5112188817103218,
                    -0.646872902559428
                ],
                "India": [
                    -0.12956695483396394,
                    -0.0673538539129271
                ],
                "Indonesia": [
                    -0.7937491697857288,
                    -1.077286700270754
                ],
                "Israel": [
                    0.1919704268327592,
                    0.5840297929744972
                ],
                "Jordan": [
                    -1.4441656373911376,
                    -1.4643912411784317
                ],
                "South Korea": [
                    1.296507514497533,
                    -0.23586415638434594
                ],
                "Montenegro": [
                    1.0927536963206297,
                    -1.0332497855105693
                ],
                "Pakistan": [
                    -1.2888747894645303,
                    -1.4487683419366022
                ],
                "Peru": [
                    -1.1742645971344607,
                    -0.45163041256914316
                ],
                "Philippines": [
                    -1.1397063687841402,
                    -0.38545466189686384
                ],
                "Puerto Rico": [
                    -2.0253786595934073,
                    0.46078246337798856
                ],
                "Serbia": [
                    0.7753250979829872,
                    -0.6269953737494034
                ],
                "Vietnam": [
                    -0.8428398369200737,
                    0.22544904185245712
                ],
                "South Africa": [
                    -0.9302622816801982,
                    -0.2575074486643199
                ],
                "Zimbabwe": [
                    -1.148680168441618,
                    -1.7243624351876345
                ],
                "Turkey": [
                    -0.39569740933058073,
                    -1.3388255686950148
                ],
                "Uganda": [
                    -1.2236334178718786,
                    -0.9602416930131703
                ],
                "North Macedonia": [
                    0.234095586155458,
                    -0.5767851794737289
                ],
                "Egypt": [
                    -1.4863291607836555,
                    -0.6988074238755576
                ],
                "Tanzania": [
                    -1.8020979149339045,
                    -0.6820902000629078
                ]
            },
            "2019": {
                "Bosnia and Herzegovina": [
                    -0.06536117267150689,
                    -0.6772335333375604
                ],
                "Taiwan ROC": [
                    1.1260896201553743,
                    -0.14471281658440266
                ],
                "Cyprus": [
                    -0.41213579360609975,
                    -0.4994959748855511
                ],
                "Japan": [
                    1.6146045005130416,
                    1.3020048943245517
                ],
                "Macau SAR": [
                    1.2713052769894333,
                    0.2036361619346146
                ],
                "Montenegro": [
                    -0.43588857294989974,
                    -0.017132867617914424
                ],
                "Philippines": [
                    -1.4145423152661651,
                    0.10567144475878894
                ],
                "Tunisia": [
                    -0.596153270563401,
                    -1.432377114999755
                ],
                "North Macedonia": [
                    0.08716356330362447,
                    -0.2686387354406287
                ]
            },
            "2020": {
                "Myanmar": [
                    -1.0254325573885172,
                    -0.9507913571544402
                ],
                "Canada": [
                    0.7975293889435482,
                    2.0554782322791185
                ],
                "Ethiopia": [
                    -1.3259353655466495,
                    -0.9801362255685239
                ],
                "Guatemala": [
                    -1.0059928111605085,
                    0.004234549711999731
                ],
                "Iran": [
                    -0.53922883657694,
                    -0.9236415707826683
                ],
                "Kyrgyzstan": [
                    -1.3943083227268935,
                    -0.5517814995081795
                ],
                "Mongolia": [
                    0.7472394074164526,
                    0.14703607592126364
                ],
                "New Zealand": [
                    0.5316814068951405,
                    2.856591030289617
                ],
                "Nicaragua": [
                    -1.7125668595835002,
                    -0.3604112161692215
                ],
                "Portugal": [
                    -0.2695937371224817,
                    0.3353091098271962
                ],
                "Singapore": [
                    0.08875171952558156,
                    -0.12013059317746784
                ],
                "Vietnam": [
                    -0.44293234916724494,
                    0.6127916090895228
                ],
                "Zimbabwe": [
                    -0.5850187780857803,
                    -1.8709498714759276
                ],
                "Tajikistan": [
                    -1.36800945718124,
                    -0.618159694547403
                ],
                "Ukraine": [
                    0.43122120904123,
                    -0.49295813837437075
                ]
            },
            "1996": {
                "Belarus": [
                    1.0104870656196627,
                    -1.3674641205518248
                ],
                "Chile": [
                    -0.6945614704251996,
                    -0.389578453086009
                ],
                "Croatia": [
                    1.158589795575281,
                    0.28336115652202865
                ],
                "Dominican Republic": [
                    -1.0011515627570782,
                    -0.1475859029119209
                ],
                "Estonia": [
                    1.5761712867822302,
                    -0.7091301304697855
                ],
                "Finland": [
                    0.5624772671799279,
                    1.2239693470733433
                ],
                "Georgia": [
                    -0.11304873808013141,
                    -1.1160386353555523
                ],
                "Latvia": [
                    1.5785232370622586,
                    -0.42360840982981873
                ],
                "Mexico": [
                    -0.8193248246078895,
                    0.08326030253797669
                ],
                "Moldova": [
                    0.6873109598285774,
                    -1.578433294419213
                ],
                "Montenegro": [
                    0.3334372141257683,
                    -0.7381636069247995
                ],
                "Norway": [
                    0.7493057908460274,
                    1.8643878118044386
                ],
                "Peru": [
                    -0.9601463107448845,
                    -0.5271196465143813
                ],
                "Philippines": [
                    -1.2042517564040442,
                    -0.49947941408715635
                ],
                "Serbia": [
                    0.9085395260932541,
                    -0.5599022538953157
                ],
                "South Africa": [
                    -1.2147661457210923,
                    -0.5997348143996036
                ],
                "Sweden": [
                    1.1170477754926065,
                    2.515662047929722
                ],
                "Switzerland": [
                    0.6943426101779832,
                    1.4431546987767094
                ],
                "Ukraine": [
                    1.113053153357374,
                    -1.3156233937417154
                ],
                "Uruguay": [
                    -0.18579644057619785,
                    0.40974127607849603
                ],
                "Venezuela": [
                    -1.8189728559690985,
                    -0.1074806631251445
                ]
            },
            "2000": {
                "Belarus": [
                    0.9312417937107367,
                    -0.645008672973915
                ],
                "Canada": [
                    -0.5517513728234105,
                    1.8667299020214736
                ],
                "Chile": [
                    -0.8709044767477977,
                    -0.12814962116737055
                ],
                "Finland": [
                    0.44431306982251556,
                    1.3130614629866657
                ],
                "Japan": [
                    1.8083184196671886,
                    0.8880342009665159
                ],
                "Mexico": [
                    -1.4838380446060426,
                    0.29960307274972436
                ],
                "Nigeria": [
                    -1.86222786757317,
                    -0.5668498743865086
                ],
                "Spain": [
                    0.11017948261993454,
                    0.8044938743519532
                ],
                "Venezuela": [
                    -1.7287159112252313,
                    0.16103383036690094
                ]
            },
            "1982": {
                "Canada": [
                    -0.828273833149072,
                    0.9582555880061999
                ],
                "Norway": [
                    0.6477074695124684,
                    0.919839135031396
                ],
                "South Africa": [
                    -0.48431398668291176,
                    -0.5693500524577716
                ]
            },
            "2007": {
                "China": [
                    0.6574873989332564,
                    -0.4791772848893661
                ],
                "Ethiopia": [
                    -0.5911105767400792,
                    -0.7049753406248781
                ],
                "Ghana": [
                    -1.7932514738153493,
                    -0.7335233433281544
                ],
                "Jordan": [
                    -1.6495749042073897,
                    -1.3243983702804885
                ],
                "Mali": [
                    -1.3851066476814065,
                    -0.11398809094206758
                ],
                "Norway": [
                    0.873896532920375,
                    2.7066874166857255
                ],
                "Rwanda": [
                    -1.2734094926632291,
                    -1.1340394488364602
                ],
                "Spain": [
                    0.19755178786714375,
                    0.8190853508483064
                ],
                "Thailand": [
                    -0.6849176150965491,
                    -0.18894650071366137
                ],
                "Turkey": [
                    -1.1102633333207745,
                    -0.7049254938194001
                ],
                "Burkina Faso": [
                    -1.222464542351113,
                    -0.8015794344448354
                ],
                "Zambia": [
                    -0.5098869674773501,
                    -0.9147574753872
                ]
            },
            "2022": {
                "Czechia": [
                    1.3322187167670665,
                    0.7298424737966401
                ],
                "Libya": [
                    -1.757540181464322,
                    -1.1256035347703055
                ],
                "Netherlands": [
                    1.1562093255891486,
                    2.3876363866039045
                ],
                "Slovakia": [
                    0.7260984113627692,
                    0.12166849759006007
                ],
                "Great Britain": [
                    0.9808428617585446,
                    2.2364355646263627
                ],
                "Uruguay": [
                    -0.3292847107177018,
                    1.361061038623971
                ],
                "Northern Ireland": [
                    0.11889628348566687,
                    1.6764126082403388
                ]
            },
            "2004": {
                "Guatemala": [
                    -1.5334604657529862,
                    -0.4366485725341856
                ],
                "New Zealand": [
                    -0.14154126893125146,
                    2.369523310221101
                ]
            },
            "2016": {
                "Haiti": [
                    -0.8593146005834521,
                    0.06864278667474041
                ]
            },
            "2010": {
                "Japan": [
                    1.6355935649803386,
                    0.8250290254966751
                ],
                "South Korea": [
                    0.9421744313024192,
                    -0.27224847427638943
                ],
                "Qatar": [
                    -2.16668853863667,
                    -0.714305684547447
                ],
                "Trinidad and Tobago": [
                    -1.755611491243614,
                    -0.3584215311982552
                ]
            },
            "2003": {
                "Kyrgyzstan": [
                    0.08921892191766975,
                    -1.064505833885252
                ],
                "Saudi Arabia": [
                    -1.50435411333099,
                    -0.416515507486782
                ]
            },
            "1992": {
                "Slovenia": [
                    0.779315801881555,
                    -0.09206417284841545
                ]
            }
        }
        
        self.llm_mappings = {'qwen3_8b_not': 'Qwen3-8B-non',
                    'qwen3_14b_not': 'Qwen3-14B-non',
                    'qwen3_8b': 'Qwen3-8B',
                    'qwen3_14b': 'Qwen3-14B',
                    'ds_qwen3_8b': 'ds-Qwen3-8B ',
                    'llama3.1-8b': 'Llama3.1-8B', 
                    'polylm_13b': 'Polylm-13B', 
                    'gpt-4o-mini': 'GPT-4o-mini',
                    'ds_llama_8b': 'ds-Llama3.1-8B'
                    }
    
    def pearson(self, all_jsr_res, lang):
        # args: 
        #   all_jsr_res: dict, {'language': {'llm': {'country': 'jsr'}}}
        #   lang: str,
        # returns:
        #   final_res: dict, {'llm': {'Pearson': {'corr': float, 'p': float}, 'Spearman': {'corr': float, 'p': float}}}

        # 
        country_newest_locations = {}
        for year, info in self.cul_maps.items():
            for country, loc in info.items():
                if country not in country_newest_locations:
                    country_newest_locations[country] = [loc, int(year)]
                else:
                    if int(year) >= country_newest_locations[country][-1]:
                        country_newest_locations[country] = [loc, int(year)]

        for x, info in country_newest_locations.items():
            country_newest_locations[x] = info[0]

        #
        country_aver_locations = {}
        country_sum = {}
        country_count = {}
        for year, info in self.cul_maps.items():
            for country, loc in info.items():
                if country not in country_sum:
                    country_sum[country] = [0.0, 0.0]
                    country_count[country] = 0
                country_sum[country][0] += loc[0]  # TradAgg 
                country_sum[country][1] += loc[1]  # SurvSAgg 
                country_count[country] += 1

        for country in country_sum:
            count = country_count[country]
            avg_trad = country_sum[country][0] / count
            avg_surv = country_sum[country][1] / count
            country_aver_locations[country] = [avg_trad, avg_surv]
            
        def pearson(country_loc, jsr_res, mappings, target_pos):
            def _distance(x1, x2, y1, y2):
                return np.sqrt((x2-x1)**2 + (y2-y1)**2)

            new_locs = {}
            for c, new_name in mappings.items():
                if new_name in country_loc:
                    new_locs[c] = country_loc[new_name]
                    
            count_ = len(new_locs.keys())
            cul_distances = [0 for i in range(count_)]
            countries = list(new_locs.keys())
            names = [self.country_ab[x] for x in countries]
            print('', count_)
            print(json.dumps(countries, ensure_ascii=False))

            statistic = defaultdict(list)
            for i in range(count_):
                coord_i = new_locs[countries[i]]
                cul_distances[i] = round(_distance(coord_i[0], coord_i[1], target_pos[0], target_pos[1]), 4)
                print(countries[i], coord_i, cul_distances[i], jsr_res[countries[i]])
                statistic[(cul_distances[i]-1.0)//0.2].append(jsr_res[countries[i]])
            
            res = sorted(statistic.items(), key=lambda x:x[0])
            for (x, y) in res:
                print(x, round(sum(y) / len(y), 4))

            jsr_list = []
            for x in countries:
                jsr_list.append(jsr_res[x])

            # ======== 1. Pearson  ========
            pearson_corr, pearson_p = pearsonr(cul_distances, jsr_list)
            print(f"Pearson r = {pearson_corr:.4f}, p-value = {pearson_p:.4f}")

            # ======== 2. Spearman  ========
            spearman_corr, spearman_p = spearmanr(cul_distances, jsr_list)
            print(f"Spearman  = {spearman_corr:.4f}, p-value = {spearman_p:.4f}")

            return {'Pearson': {'corr': round(pearson_corr, 3), 'p': round(pearson_p, 3)},
                    'Spearman': {'corr': round(spearman_corr, 3), 'p': round(spearman_p, 3)}}

        en_speaking = ['New Zealand', 'Great Britain', 'Canada', 'Australia', 'United States', 'Northern Ireland']
        zh_speaking = ['China']
        es_speaking = ['Spain']
        loc = 'newest'
        loc = 'aver'
        if loc == 'newest':
            country_loc = country_newest_locations
        elif loc == 'aver':
            country_loc = country_aver_locations
        center_pos = [0,0]
        if 'en' in lang:
            center_countries = en_speaking
        elif 'zh' in lang:
            center_countries = zh_speaking
        elif 'es' in lang:
            center_countries = es_speaking

        len_ = len(center_countries)
        for x in center_countries:
            print(x, country_loc[x])
            center_pos[0] += country_loc[x][0]
            center_pos[1] += country_loc[x][1]
        
        center_pos = [center_pos[0]/len_, center_pos[1]/len_]

        print('center_pos:', center_pos)
        final_res = {}
        print(lang)
        print(loc)
        for res_llm, info in all_jsr_res[lang].items():
            print('res_llm:', res_llm)
            print(info)
            final_res[res_llm] = pearson(country_loc, info, self.mappings, center_pos)
        
        print(json.dumps(final_res, ensure_ascii=False))
        return final_res

    def draw_bubble(self, all_pearson_res):
        # args:
        #   all_pearson_res: dict, {'language': {'llm': 'Pearson'}}
        #   llm_mappings: dict, {'qwen3_8b': 'Qwen3-8B'}
        # return:
        #   none
        all_data = []
        for lang, info in all_pearson_res.items():
            if 'en' in lang:
                lang = 'EN'
            elif 'zh' in lang:
                lang = 'ZH'
            elif 'es' in lang:
                lang = 'ES'
            else:
                print('analysis/draw_bubble, unknown language:', lang)

            llms = []
            pearsons = []
            p_values = []
            langs = []
            for llm, info in info.items():
                llms.append(self.llm_mappings[llm])
                pearsons.append(info['Pearson']['corr'])
                p_values.append(info['Pearson']['p'])
                langs.append(lang)

            all_data.append(pd.DataFrame({
                'llm': llms,
                'Pearson': pearsons,
                'p_value': p_values,
                'lang': langs
            }))

        df = pd.concat(all_data, ignore_index=True)

        print(df)
        # p
        bubble_size = abs(df['Pearson'])+1e-6
        df['size'] = 500 * bubble_size / bubble_size.max()

        # 
        color_map = {'EN':'#7BC0CD','ZH':'#ECB66C', 'ES': '#E9687A'}
        df['color'] = df['lang'].map(color_map)

        # marker 
        def p_to_marker(p):
            if p < 0.001:
                return 'o'   # circle, 
            elif p < 0.01:
                return '^'   # triangle, 
            elif p < 0.05:
                return 's'   # square, 
            else:
                return 'x'   # cross, 

        df['marker'] = df['p_value'].apply(p_to_marker)
        plt.figure(figsize=(11,5))
        for _, row in df.iterrows():
            # plt.scatter(row['Pearson'], row['llm'],
            #             s=row['size'], c=row['color'], 
            #             marker=row['marker'], alpha=0.7, edgecolors='k')
            if row['marker'] not in ['x']:
                plt.scatter(row['llm'], row['Pearson'],
                        s=row['size'], c=row['color'], 
                        marker=row['marker'], alpha=0.7, edgecolors='k')
            else:
                plt.scatter(row['llm'], row['Pearson'],
                            s=row['size'], c=row['color'], 
                            marker=row['marker'], alpha=0.7, edgecolors='k', linewidths=4)
            
                        
        # plt.axvline(0, color='grey', linestyle='--', lw=1)
        # plt.xlabel('Pearson Correlation Coefficient', fontsize=12)
        # plt.ylabel('Model', fontsize=12)
        plt.ylabel('Pearson Correlation Coefficient', fontsize=12)
        plt.xlabel('Model', fontsize=12)
        plt.xticks(fontsize=10) # , rotation=20
        plt.yticks(fontsize=10)
        # plt.title('Correlation between Cultural Distance and Jailbreak Success Rate')
        plt.grid(alpha=0.3)
        lang_title = mlines.Line2D([], [], color='white', marker='', linestyle='',
                            label='Color = Language')
        en_patch = mpatches.Patch(color=color_map['EN'], label='English')
        zh_patch = mpatches.Patch(color=color_map['ZH'], label='Chinese')
        es_patch = mpatches.Patch(color=color_map['ES'], label='Spanish')  # 

        # 
        shape_title = mlines.Line2D([], [], color='white', marker='', linestyle='',
                                label='Shape = Significance Level')
        circle = mlines.Line2D([], [], color='k', marker='o', linestyle='None',
                            markersize=8, markerfacecolor='none',label='p < 0.001')
        triangle = mlines.Line2D([], [], color='k', marker='^', linestyle='None',
                                markersize=8, markerfacecolor='none',label='p < 0.01')
        square = mlines.Line2D([], [], color='k', marker='s', linestyle='None',
                            markersize=8, markerfacecolor='none',label='p < 0.05')
        cross = mlines.Line2D([], [], color='k', marker='x', linestyle='None', markeredgewidth=3,  # 
                            markersize=8, markerfacecolor='none',label='p  0.05')
        # plt.legend(handles=[circle, triangle, square, cross],
        #        title='Significance Level', loc='lower right')
        plt.legend(handles=[lang_title, en_patch, zh_patch, es_patch, 
                        shape_title, circle, triangle, square, cross], fontsize=10, loc='upper left')

        plt.tight_layout()
        plt.savefig('../paper/pearson.png', dpi=500)

    def draw_geo_llm(self, all_jsr_res, llm):
        # args:
        #   all_jsr_res: dict, {'language': {'country': 'jsr'}}
        # return:
        #   none

        world = gpd.read_file('./data/countries.geojson')
        # print(world.columns)

        world.rename(columns={'ISO3166-1-Alpha-3': 'iso_a3'}, inplace=True)

        vmin = min(min(vals.values()) for vals in all_jsr_res.values())
        vmax = max(max(vals.values()) for vals in all_jsr_res.values())

        fig, axes = plt.subplots(1, 3, figsize=(28, 10), dpi=150) # , constrained_layout=True)
        for ax, lang in zip(axes, list(all_jsr_res.keys())):
            iso_value = {self.country_ab[k]: v for k, v in all_jsr_res[lang].items() if k in self.country_ab}
            print('iso_value:', json.dumps(iso_value, ensure_ascii=False))
            world['value'] = world['iso_a3'].map(iso_value)

            #  vmin, vmax 
            world.plot(
                column='value',
                ax=ax,
                cmap='coolwarm',
                vmin=vmin,
                vmax=vmax,
                missing_kwds={"color": "lightgrey"},
            )

            if 'en' in lang:
                lang = 'English'
            elif 'zh' in lang:
                lang = 'Chinese'
            elif 'es' in lang:
                lang = 'Spanish'
            ax.set_aspect('equal')  # 
            ax.set_title(f"{lang}", fontsize=14)
            ax.axis('off')

        # =======================
        # 3.  Colorbar
        # =======================
        #  ScalarMappable  colorbar
        sm = mpl.cm.ScalarMappable(cmap="coolwarm", norm=mpl.colors.Normalize(vmin=vmin, vmax=vmax))
        sm.set_array([])

        # 
        fig.subplots_adjust(top=0.92, bottom=0.12, wspace=0.02)

        # colorbar 
        cbar = fig.colorbar(sm, ax=axes, orientation="horizontal", fraction=0.05, pad=0.02)
        cbar.set_label("JSR Value", fontsize=12)

        # plt.tight_layout(rect=[0, 0.05, 1, 0.95])
        plt.savefig("../paper/jsr/"+llm+"_jsr.png", dpi=500)
        plt.close(fig)

    def draw_geo(self, all_jsr_res):
        # args:
        #   all_jsr_res: dict, {'llm': {'language': {'country': 'jsr'}}}
        # return:
        #   none

        world = gpd.read_file('./data/countries.geojson')
        # print(world.columns)
        models = list(all_jsr_res.keys())
        n_models = len(models)
        langs = list(all_jsr_res[models[0]].keys())
        n_langs = len(langs)
        fig, axes = plt.subplots(
                        n_models, n_langs,
                        figsize=(30, 5 * n_models),
                        dpi=150
                    )
        
        world.rename(columns={'ISO3166-1-Alpha-3': 'iso_a3'}, inplace=True)

        vmin = min(
                    min(vals.values()) 
                    for model in models
                    for lang in langs
                    for vals in [all_jsr_res[model][lang]]
                )
        vmax = max(
            max(vals.values())
            for model in models
            for lang in langs
            for vals in [all_jsr_res[model][lang]]
        )
        
        for i, model in enumerate(models):
            for j, lang in enumerate(langs):

                ax = axes[i][j]

                iso_value = {
                    self.country_ab[k]: v
                    for k, v in all_jsr_res[model][lang].items()
                    if k in self.country_ab
                }

                world["value"] = world["iso_a3"].map(iso_value)

                world.plot(
                    column="value",
                    ax=ax,
                    cmap="coolwarm",
                    vmin=vmin,
                    vmax=vmax,
                    missing_kwds={"color": "lightgrey"},
                )

                ax.set_aspect("equal")
                ax.axis("off")

                #  1 
                if i == 0:
                    lang_name = {"en_": "English", "zh_": "Chinese", "es_": "Spanish"}[lang]
                    ax.set_title(lang_name, fontsize=18)

                #  1 
                if j == 0:
                    ax.text(
                        -0.05, 0.5, model,
                        va="center", ha="right",
                        rotation=90,
                        fontsize=16,
                        transform=ax.transAxes,
                    )

        # =======================
        # 3.  Colorbar
        # =======================
        #  ScalarMappable  colorbar
        fig.tight_layout(rect=[0, 0.08, 1, 0.95])  #  colorbar

        cbar_ax = fig.add_axes([0.15, 0.03, 0.7, 0.02])  #  colorbar
        sm = mpl.cm.ScalarMappable(cmap="coolwarm", norm=mpl.colors.Normalize(vmin=vmin, vmax=vmax))
        sm.set_array([])
        cbar = fig.colorbar(sm, cax=cbar_ax, orientation='horizontal')
        cbar.set_label("JSR Value", fontsize=14)

        plt.savefig("../paper/jsr_all_models.png", dpi=500)
        plt.close(fig)


def draw_pearson_pic():
    # the correlation between jsr and cultural distance
    all_llms = ['qwen3_8b_not', 'qwen3_14b_not', 'llama3.1-8b', 'polylm_13b', 'gpt-4o-mini', 'qwen3_8b', 'qwen3_14b', 'ds_qwen3_8b', 'ds_llama_8b']
    draw_api =  Draw()
    all_jsr_res = defaultdict(dict)
    lang = 'es_'
    for eval_llm in all_llms:
        file = './eval/gpt-4o_'+lang+eval_llm+'_jailbreak_qs_eval.json'
        jsr_res = statistic4implicit(file)
        all_jsr_res[lang][eval_llm] = jsr_res['jsr_by_country']
    
    lang = 'en_'
    for eval_llm in all_llms:
        file = '../jailbreak/xingzhou2/llm_eval_1/'+eval_llm+'_jailbreak_en_query_eval.json'
        jsr_res = statistic4implicit(file)
        all_jsr_res[lang][eval_llm] = jsr_res['jsr_by_country']

    lang = 'zh_'
    for eval_llm in all_llms:
        file = '../jailbreak/xingzhou1/llm_eval_1/'+eval_llm+'_jailbreak_zh_query_eval.json'
        jsr_res = statistic4implicit(file)
        all_jsr_res[lang][eval_llm] = jsr_res['jsr_by_country']

    all_pearson_res = {}
    for lang in ['es_', 'en_', 'zh_']:
        all_pearson_res[lang] = draw_api.pearson(all_jsr_res, lang)
    draw_api.draw_bubble(all_pearson_res)


def draw_jsr_pic():
    # show jsr in the world map
    all_llms = ['qwen3_8b_not', 'qwen3_14b_not', 'llama3.1-8b', 'polylm_13b', 'gpt-4o-mini', 'qwen3_8b', 'qwen3_14b', 'ds_qwen3_8b', 'ds_llama_8b']

    lang = 'es_'
    draw_api =  Draw()
    all_jsr_res = defaultdict(dict)
    for eval_llm in all_llms:
        file = './eval/gpt-4o_'+lang+eval_llm+'_jailbreak_qs_eval.json'
        jsr_res = statistic4implicit(file)
        all_jsr_res[eval_llm][lang] = jsr_res['jsr_by_country']
    
    lang = 'en_'
    for eval_llm in all_llms:
        file = '../jailbreak/xingzhou2/llm_eval_1/'+eval_llm+'_jailbreak_en_query_eval.json'
        jsr_res = statistic4implicit(file)
        all_jsr_res[eval_llm][lang] = jsr_res['jsr_by_country']

    lang = 'zh_'
    for eval_llm in all_llms:
        file = '../jailbreak/xingzhou1/llm_eval_1/'+eval_llm+'_jailbreak_zh_query_eval.json'
        jsr_res = statistic4implicit(file)
        all_jsr_res[eval_llm][lang] = jsr_res['jsr_by_country']
    
    # for eval_llm in all_llms:
    #     print(json.dumps(all_jsr_res[eval_llm], ensure_ascii=False))
    #     draw_api.draw_geo(all_jsr_res[eval_llm], eval_llm)
    #     break

    draw_api.draw_geo(all_jsr_res)

if __name__ == '__main__':
    # draw_pearson_pic()
    draw_jsr_pic()